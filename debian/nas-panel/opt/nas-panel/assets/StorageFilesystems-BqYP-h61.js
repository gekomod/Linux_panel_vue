import{_ as ce,x as pe,q as V,r as y,y as O,k as fe,e as r,o as i,w as s,a,n as ve,c as $,f as w,b as m,m as D,F as T,g as k,t as d,h as c,p as ye,l as g,I as h,G as ge,E as P,z as he}from"./index-DxMqavst.js";const be={class:"widget-header"},we={class:"header-actions"},_e={key:0,class:"warning-message"},Fe={class:"device-cell"},$e={class:"size-cell"},ke={class:"mount-cell"},ze={key:0,class:"read-only-badge"},Ve={key:0,class:"error-message"},De={name:"StorageFilesystemsWidget",displayName:"Systemy plików"},Te=Object.assign(De,{setup(Pe){const{t:L}=pe();V.defaults.baseURL=`${window.location.protocol}//${window.location.hostname}:3000`;const E=y([]),U=y([]),p=y(!1),b=y(null),C=y(!1),Z=y(!1),n=y({device:"",partition:"",mountPoint:"",fsType:"ext4",options:"defaults,nofail",zfsPoolName:""}),N=y(!1),A=y(!1),u=y({device:"",fsType:"ext4",label:"",zfsPoolName:"zpool",force:!1}),K=y(["bcachefs","btrfs","ext4","f2fs","jfs","xfs","zfs"]);O(()=>U.value.flatMap(e=>{const t={path:e.path,model:e.model,type:e.type},o=e.partitions?.map(f=>({path:f.path,model:e.model,type:f.type}))||[];return[t,...o]}).filter(e=>!e.path.includes("loop")));const G=O(()=>{const e=E.value.map(o=>o.device);return U.value.flatMap(o=>o.partitions.map(f=>({...f,model:o.model,serial:o.serial}))).filter(o=>!e.includes(o.path)&&!o.path.includes("loop")&&!o.path.includes("ram")&&o.type==="part")}),Y=O(()=>{const e=E.value.map(t=>t.device);return U.value.flatMap(t=>t.partitions.filter(o=>!e.includes(o.path)&&!o.path.includes("loop")&&!o.path.includes("ram")).map(o=>({...o,model:o.model||"Unknown"})))}),M=y([]),H=e=>{const t=U.value.find(o=>o.path===e);M.value=t?.partitions||[],n.value.partition=M.value[0]?.path||""},J=async()=>{try{p.value=!0,await I(),C.value=!0}catch(e){b.value=L("storageFilesystems.errorLoadingDevices"),console.error("Error loading devices:",e)}finally{p.value=!1}},Q=async()=>{try{p.value=!0,await I(),N.value=!0}catch(e){b.value=L("storageFilesystems.errorLoadingDevices"),console.error("Error loading devices:",e)}finally{p.value=!1}},X=async()=>{try{Z.value=!0,b.value=null;const e=n.value.partition||n.value.device,o=n.value.fsType==="zfs"&&!n.value.mountPoint?n.value.zfsPoolName||"zpool":n.value.mountPoint,f=await V.post("/api/storage/mount",{device:e,mountPoint:o,fsType:n.value.fsType,options:n.value.options,zfsPoolName:n.value.zfsPoolName});f.data.success&&(P({title:"Success",message:f.data.isZfs?`ZFS pool ${n.value.zfsPoolName||"zpool"} mounted successfully`:"Device mounted successfully",type:"success"}),C.value=!1,await S())}catch(e){b.value=e.response?.data?.details||e.message,P({title:"Mount Error",message:b.value,type:"error",duration:0})}finally{Z.value=!1}},x=async()=>{try{if(A.value=!0,u.value.fsType==="zfs"){const t=u.value.device.replace(/[0-9]+$/,"");try{await he.confirm(`<strong>UWAGA: ZFS wymaga całego dysku!</strong><br><br>
          Będziemy używać <strong>${t}</strong> zamiast ${u.value.device}.<br>
          <span style="color:red;">WSZYSTKIE DANE NA DYSKU ZOSTANĄ USUNIĘTE.</span><br><br>
          Kontynuować?`,"Potwierdzenie tworzenia ZFS",{confirmButtonText:"Tak, utwórz ZFS",cancelButtonText:"Anuluj",type:"error",dangerouslyUseHTMLString:!0})}catch{return}}const e=await V.post("/api/storage/format",{device:u.value.device,fsType:u.value.fsType,label:u.value.zfsPoolName,force:!0});P.success({title:"Sukces",message:`Utworzono ${u.value.fsType.toUpperCase()} na ${e.data.deviceUsed}`,duration:5e3}),N.value=!1,await S()}catch(e){let t=e.response?.data?.details||e.message;t.includes("no such device")&&(t=`Urządzenie ${e.response?.data?.targetDevice} nie istnieje`),P.error({title:"Błąd formatowania",message:t,duration:0})}finally{A.value=!1}},ee=async e=>{try{p.value=!0;const t=await V.post("/api/storage/unmount",{mountPoint:e});P({title:"Success",message:t.data.isZfs?"ZFS pool unmounted successfully":"Filesystem unmounted successfully",type:"success"}),await S()}catch(t){b.value=t.response?.data?.details||t.message,P({title:"Unmount Error",message:b.value,type:"error",duration:0})}finally{p.value=!1}},I=async()=>{try{const e=await V.get("/api/storage/devices");U.value=e.data.data||[]}catch(e){throw console.error("Error fetching devices:",e),e}},S=async()=>{try{p.value=!0;const e=await V.get("/api/storage/filesystems");Array.isArray(e.data?.data)&&(E.value=e.data.data)}catch(e){b.value=L("storageFilesystems.errorLoading"),console.error("Error fetching filesystems:",e)}finally{p.value=!1}},le=e=>e?.includes("nvme")?"mdi:memory":e?.includes("sd")||e?.includes("hd")?"mdi:harddisk":e?.includes("md")?"mdi:raid":e?.includes("zfs")?"mdi:database":"mdi:harddisk",te=e=>({ext4:"mdi:linux",xfs:"mdi:file-tree",ntfs:"mdi:windows",fat:"mdi:usb-flash-drive",zfs:"mdi:database",btrfs:"mdi:database",bcachefs:"mdi:database",f2fs:"mdi:flash",jfs:"mdi:file-tree"})[e.toLowerCase()]||"mdi:file-question",ae=e=>({active:"mdi:check-circle",inactive:"mdi:close-circle",readonly:"mdi:lock",error:"mdi:alert-circle",unknown:"mdi:help-circle"})[e.toLowerCase()]||"mdi:help-circle",se=e=>({active:"success",inactive:"info",readonly:"warning",error:"danger",unknown:""})[e.toLowerCase()]||"",oe=e=>e>90?"#F56C6C":e>70?"#E6A23C":"#67C23A",W=(e,t=2)=>{if(!e)return"0 Bytes";const o=1024,f=["Bytes","KB","MB","GB","TB"],_=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,_)).toFixed(t))+" "+f[_]};return fe(()=>{S(),I()}),(e,t)=>{const o=m("el-button"),f=m("el-tooltip"),_=m("el-option"),B=m("el-select"),v=m("el-form-item"),z=m("el-input"),q=m("el-form"),R=m("el-dialog"),ne=m("el-switch"),ie=m("el-alert"),F=m("el-table-column"),j=m("el-tag"),ue=m("el-progress"),re=m("el-table"),de=m("el-card"),me=ye("loading");return i(),r(de,{class:"filesystems-widget"},{header:s(()=>[c("div",be,[a(g(h),{icon:"mdi:file-tree",width:"20",height:"20"}),c("span",null,d(e.$t("storageFilesystems.title")),1),c("div",we,[a(f,{content:e.$t("storageFilesystems.mount")},{default:s(()=>[a(o,{size:"small",onClick:J,disabled:p.value,text:""},{default:s(()=>[a(g(h),{icon:"mdi:usb-flash-drive",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(f,{content:e.$t("storageFilesystems.format")},{default:s(()=>[a(o,{size:"small",onClick:Q,disabled:p.value,text:""},{default:s(()=>[a(g(h),{icon:"mdi:format-list-checks",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(f,{content:e.$t("storageFilesystems.refresh")},{default:s(()=>[a(o,{size:"small",onClick:S,loading:p.value,text:""},{default:s(()=>[a(g(h),{icon:"mdi:refresh",width:"16",height:"16",class:ge({spin:p.value})},null,8,["class"])]),_:1},8,["loading"])]),_:1},8,["content"])])])]),default:s(()=>[a(R,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=l=>C.value=l),title:e.$t("storageFilesystems.mountDialog.title"),width:"500px"},{footer:s(()=>[a(o,{onClick:t[6]||(t[6]=l=>C.value=!1)},{default:s(()=>[k(d(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"primary",onClick:X,loading:Z.value},{default:s(()=>[k(d(e.$t("storageFilesystems.mountDialog.mount")),1)]),_:1},8,["loading"])]),default:s(()=>[a(q,{model:n.value,"label-position":"top"},{default:s(()=>[a(v,{label:e.$t("storageFilesystems.mountDialog.device")},{default:s(()=>[a(B,{modelValue:n.value.device,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value.device=l),placeholder:e.$t("storageFilesystems.mountDialog.selectDevice"),onChange:H,style:{width:"100%"}},{default:s(()=>[(i(!0),$(T,null,D(G.value,l=>(i(),r(_,{key:l.path,label:`${l.path} (${l.model||"Unknown"})`,value:l.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),M.value.length>0?(i(),r(v,{key:0,label:e.$t("storageFilesystems.mountDialog.partition")},{default:s(()=>[a(B,{modelValue:n.value.partition,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value.partition=l),placeholder:"Select partition",style:{width:"100%"}},{default:s(()=>[(i(!0),$(T,null,D(M.value,l=>(i(),r(_,{key:l.path,label:l.path,value:l.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):w("",!0),n.value.fsType!=="zfs"?(i(),r(v,{key:1,label:e.$t("storageFilesystems.mountDialog.mountPoint")},{default:s(()=>[a(z,{modelValue:n.value.mountPoint,"onUpdate:modelValue":t[2]||(t[2]=l=>n.value.mountPoint=l),placeholder:"/mnt/new_disk"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),a(v,{label:e.$t("storageFilesystems.mountDialog.fsType")},{default:s(()=>[a(B,{modelValue:n.value.fsType,"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.fsType=l),placeholder:e.$t("storageFilesystems.mountDialog.selectFsType"),style:{width:"100%"}},{default:s(()=>[(i(!0),$(T,null,D(K.value,l=>(i(),r(_,{key:l,label:l,value:l.toLowerCase()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n.value.fsType==="zfs"?(i(),r(v,{key:2,label:e.$t("storageFilesystems.mountDialog.zfsPoolName")},{default:s(()=>[a(z,{modelValue:n.value.zfsPoolName,"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.zfsPoolName=l),placeholder:"mypool"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),n.value.fsType!=="zfs"?(i(),r(v,{key:3,label:e.$t("storageFilesystems.mountDialog.options")},{default:s(()=>[a(z,{modelValue:n.value.options,"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.options=l),placeholder:"defaults,nofail"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(R,{modelValue:N.value,"onUpdate:modelValue":t[14]||(t[14]=l=>N.value=l),title:e.$t("storageFilesystems.formatDialog.title"),width:"500px"},{footer:s(()=>[a(o,{onClick:t[13]||(t[13]=l=>N.value=!1)},{default:s(()=>[k(d(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"danger",onClick:x,loading:A.value},{default:s(()=>[k(d(e.$t("storageFilesystems.formatDialog.format")),1)]),_:1},8,["loading"])]),default:s(()=>[a(q,{model:u.value,"label-position":"top"},{default:s(()=>[a(v,{label:e.$t("storageFilesystems.formatDialog.device")},{default:s(()=>[a(B,{modelValue:u.value.device,"onUpdate:modelValue":t[8]||(t[8]=l=>u.value.device=l),placeholder:e.$t("storageFilesystems.formatDialog.selectDevice"),style:{width:"100%"}},{default:s(()=>[(i(!0),$(T,null,D(Y.value,l=>(i(),r(_,{key:l.path,label:`${l.path} (${l.model||"Unknown"}) ${l.fstype?`[${l.fstype}]`:""}`,value:l.path},null,8,["label","value"]))),128)),(i(!0),$(T,null,D(G.value,l=>(i(),r(_,{key:l.path,label:`${l.path} (${l.model||"Unknown"})`,value:l.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(v,{label:e.$t("storageFilesystems.formatDialog.fsType")},{default:s(()=>[a(B,{modelValue:u.value.fsType,"onUpdate:modelValue":t[9]||(t[9]=l=>u.value.fsType=l),placeholder:e.$t("storageFilesystems.formatDialog.selectFsType"),style:{width:"100%"}},{default:s(()=>[(i(!0),$(T,null,D(K.value,l=>(i(),r(_,{key:l,label:l,value:l.toLowerCase()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u.value.fsType==="zfs"?(i(),r(v,{key:0,label:e.$t("storageFilesystems.formatDialog.zfsPoolName")},{default:s(()=>[a(z,{modelValue:u.value.zfsPoolName,"onUpdate:modelValue":t[10]||(t[10]=l=>u.value.zfsPoolName=l),placeholder:"mypool"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),u.value.fsType==="zfs"?(i(),r(v,{key:1,label:"Urządzenie (automatycznie wybrano cały dysk)"},{default:s(()=>[a(z,{value:u.value.device.replace(/[0-9]+$/,""),disabled:""},null,8,["value"]),t[15]||(t[15]=c("div",{class:"el-form-item__description"}," ZFS wymaga całego dysku (np. /dev/sda zamiast /dev/sda1) ",-1))]),_:1,__:[15]})):(i(),r(v,{key:2,label:e.$t("storageFilesystems.formatDialog.label")},{default:s(()=>[a(z,{modelValue:u.value.label,"onUpdate:modelValue":t[11]||(t[11]=l=>u.value.label=l),placeholder:`${u.value.fsType.toUpperCase()}_VOLUME`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),a(v,{label:e.$t("storageFilesystems.formatDialog.force")},{default:s(()=>[a(ne,{modelValue:u.value.force,"onUpdate:modelValue":t[12]||(t[12]=l=>u.value.force=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),u.value.device?(i(),$("div",_e,[a(ie,{type:"warning",closable:!1},{default:s(()=>[k(d(e.$t("storageFilesystems.formatDialog.warning",{device:u.value.device})),1)]),_:1})])):w("",!0)]),_:1},8,["modelValue","title"]),ve((i(),r(re,{data:E.value,style:{width:"100%"}},{default:s(()=>[a(F,{label:e.$t("storageFilesystems.device"),prop:"device",width:"120"},{default:s(({row:l})=>[c("div",Fe,[a(g(h),{icon:le(l.device),width:"18",height:"18"},null,8,["icon"]),c("span",null,d(l.device),1)])]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.tags"),prop:"tags",width:"100"},{default:s(({row:l})=>[l.tags?(i(),r(j,{key:0,size:"small"},{default:s(()=>[k(d(l.tags),1)]),_:2},1024)):w("",!0)]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.type"),prop:"type",width:"100"},{default:s(({row:l})=>[a(g(h),{icon:te(l.type),width:"16",height:"16"},null,8,["icon"]),c("span",null,d(l.type),1)]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.available"),prop:"available",width:"120"},{default:s(({row:l})=>[c("div",$e,[a(g(h),{icon:"mdi:harddisk-plus",width:"16",height:"16"}),c("span",null,d(W(l.available)),1)])]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.used"),prop:"used",width:"400"},{default:s(({row:l})=>[a(ue,{percentage:l.usedPercent,color:oe(l.usedPercent),"show-text":!1,"stroke-width":14},null,8,["percentage","color"]),c("span",null,d(W(l.used))+" ("+d(l.usedPercent)+"%)",1)]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.mounted"),prop:"mounted"},{default:s(({row:l})=>[c("div",ke,[a(g(h),{icon:"mdi:folder-marker",width:"16",height:"16"}),c("span",null,d(l.mounted),1)])]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.reference"),prop:"reference",width:"120"},{default:s(({row:l})=>[l.reference?(i(),r(j,{key:0,size:"small",type:"info"},{default:s(()=>[k(d(l.reference),1)]),_:2},1024)):w("",!0)]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.status"),prop:"status",width:"120"},{default:s(({row:l})=>[a(j,{type:se(l.status),size:"small"},{default:s(()=>[a(g(h),{icon:ae(l.status),width:"14",height:"14"},null,8,["icon"]),c("span",null,[k(d(l.status)+" ",1),l.readOnly?(i(),$("span",ze,"(RO)")):w("",!0)])]),_:2},1032,["type"])]),_:1},8,["label"]),a(F,{label:e.$t("storageFilesystems.actions"),width:"150"},{default:s(({row:l})=>[a(o,{size:"small",onClick:Ue=>ee(l.mounted),disabled:l.status!=="active",text:""},{default:s(()=>[a(g(h),{icon:"mdi:eject",width:"16",height:"16"}),k(" "+d(e.$t("storageFilesystems.unmount")),1)]),_:2},1032,["onClick","disabled"])]),_:1},8,["label"])]),_:1},8,["data"])),[[me,p.value]]),b.value?(i(),$("div",Ve,[a(g(h),{icon:"mdi:alert-circle",width:"18",height:"18"}),c("span",null,d(b.value),1)])):w("",!0)]),_:1})}}}),Ne=ce(Te,[["__scopeId","data-v-97364eb8"]]);export{Ne as default};
