import{_ as H,x as Q,r as _,q as y,k as X,c as w,o as c,a as t,w as n,e as h,f,n as Y,h as i,t as d,l as a,b as g,M as ee,g as M,p as te,I as m,G as N,F as R,N as ae,E as I,u as oe}from"./index-DxMqavst.js";const le={class:"widget-header"},ne={class:"header-actions"},se={class:"device-cell"},re={class:"vendor-cell"},ie={class:"capacity-cell"},ce={key:1,class:"temp-cell temp-unknown"},de={key:1,class:"error-message"},me={name:"StorageSmartDevices",displayName:"Monitorowane urządzenia"},ue=Object.assign(me,{setup(pe){const{t:l}=Q(),S=_([]),v=_(!1),b=_(null),x=_(!1),A=_(""),k=_(!1),T=_(""),E=oe();y.defaults.baseURL=`${window.location.protocol}//${window.location.hostname}:3000`;const $=e=>e.startsWith("nvme")?"mdi:memory":(e.startsWith("sd"),"mdi:harddisk"),U=e=>{T.value=JSON.stringify(e.rawData,null,2),k.value=!0},z=e=>({Samsung:"simple-icons:samsung","Western Digital":"simple-icons:westerndigital",Seagate:"simple-icons:seagate",Toshiba:"simple-icons:toshiba",Intel:"simple-icons:intel"})[e]||null,F=(e,s=2)=>{if(isNaN(e))return l("common.na");if(e===0)return"0 Bytes";const r=1024,p=["Bytes","KB","MB","GB","TB"],C=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,C)).toFixed(s))+" "+p[C]},j=e=>e==null?"temp-unknown":e>60?"temp-high":e>50?"temp-warning":"temp-normal",W=e=>{switch(e){case"healthy":return"success";case"warning":return"warning";case"error":return"danger";default:return"info"}},G=e=>{E.push(`/storage/smart/devices/details/${encodeURIComponent(e)}`)},L=()=>{navigator.clipboard.writeText(l("storageSmart.installCommand")),ElMessage.success(l("storageSmart.commandCopied"))},V=async()=>{try{v.value=!0,b.value=null;const[e,s]=await Promise.all([y.get("/api/storage/smart"),y.get("/api/storage/smart/monitoring")]);S.value=e.data.data.map(r=>{const p=s.data.devices[r.device]?.monitored||!1;return{...r,monitored:p,loading:!1}})}catch(e){if(b.value=l("storageSmart.errorLoading"),console.error("Error fetching devices:",e),e.response?.config?.url.includes("monitoring"))try{const s=await y.get("/api/storage/smart");S.value=s.data.data.map(r=>({...r,monitored:!1,loading:!1}))}catch(s){console.error("Error fetching SMART data:",s)}}finally{v.value=!1}},O=async e=>{const s=e.monitored;e.loading=!0;try{const r=await y.post("/api/storage/smart/monitoring",{device:e.device,enabled:s});e.monitored=s,I.success({title:l("storageSmart.title"),message:r.data.message||(e.monitored?l("storageSmart.enableMonitoring"):l("storageSmart.disableMonitoring"))})}catch(r){e.monitored=s,I.error({title:l("storageSmart.title"),message:r.response?.data?.error||l("common.error"),duration:3e3})}finally{e.loading=!1}};return X(async()=>{await V(),S.value.length===0&&!b.value&&(x.value=!0)}),(e,s)=>{const r=g("el-button"),p=g("el-tooltip"),C=g("el-input"),P=g("el-alert"),Z=g("el-switch"),u=g("el-table-column"),B=g("el-tag"),q=g("el-table"),J=g("el-card"),K=te("loading");return c(),w(R,null,[t(J,{class:"storage-smart-widget"},{header:n(()=>[i("div",le,[t(a(m),{icon:"mdi:harddisk-check",width:"20",height:"20"}),i("span",null,d(a(l)("storageSmart.title")),1),i("div",ne,[t(p,{content:a(l)("storageSmart.refresh")},{default:n(()=>[t(r,{size:"small",onClick:V,loading:v.value,text:""},{default:n(()=>[t(a(m),{icon:"mdi:refresh",width:"16",height:"16",class:N({spin:v.value})},null,8,["class"])]),_:1},8,["loading"])]),_:1},8,["content"])])])]),default:n(()=>[x.value?(c(),h(P,{key:0,title:a(l)("storageSmart.notAvailableTitle"),type:"warning",description:a(l)("storageSmart.notAvailableMessage"),"show-icon":"",closable:!1,class:"mb-4"},{default:n(()=>[i("p",null,d(a(l)("storageSmart.notAvailableSolution")),1),t(C,{"model-value":a(l)("storageSmart.installCommand"),readonly:"",class:"mb-2"},{append:n(()=>[t(r,{onClick:L,icon:a(ee)},null,8,["icon"])]),_:1},8,["model-value"]),t(r,{type:"primary",size:"small",onClick:V},{default:n(()=>[M(d(a(l)("storageSmart.retry")),1)]),_:1})]),_:1},8,["title","description"])):f("",!0),Y((c(),h(q,{data:S.value,style:{width:"100%"},"row-key":"device","empty-text":A.value},{default:n(()=>[t(u,{label:a(l)("storageSmart.monitored"),width:"120"},{default:n(({row:o})=>[t(Z,{modelValue:o.monitored,"onUpdate:modelValue":D=>o.monitored=D,onChange:D=>O(o),loading:o.loading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1},8,["label"]),t(u,{label:a(l)("storageSmart.device"),prop:"device",width:"120"},{default:n(({row:o})=>[i("div",se,[t(a(m),{icon:$(o.device),width:"18",height:"18"},null,8,["icon"]),i("span",null,d(o.device),1)])]),_:1},8,["label"]),t(u,{label:a(l)("storageSmart.model"),prop:"model"},null,8,["label"]),t(u,{label:a(l)("storageSmart.vendor"),prop:"vendor"},{default:n(({row:o})=>[i("div",re,[z(o.vendor)?(c(),h(a(m),{key:0,icon:z(o.vendor),width:"18",height:"18"},null,8,["icon"])):f("",!0),i("span",null,d(o.vendor),1)])]),_:1},8,["label"]),t(u,{label:a(l)("storageSmart.serial"),prop:"serial"},null,8,["label"]),t(u,{label:a(l)("storageSmart.wwn"),prop:"wwn"},null,8,["label"]),t(u,{label:a(l)("storageSmart.capacity"),prop:"capacity",width:"120"},{default:n(({row:o})=>[i("div",ie,[t(a(m),{icon:"mdi:database",width:"16",height:"16"}),i("span",null,d(F(o.capacity)),1)])]),_:1},8,["label"]),t(u,{label:a(l)("storageSmart.temperature"),prop:"temperature",width:"150"},{default:n(({row:o})=>[o.temperature!==null?(c(),w("div",{key:0,class:N(["temp-cell",j(o.temperature)])},[t(a(m),{icon:"mdi:thermometer",width:"16",height:"16"}),i("span",null,d(o.temperature)+"°C",1),o.rawData?(c(),h(p,{key:0,content:"Zobacz surowe dane SMART",placement:"top"},{default:n(()=>[t(r,{size:"small",circle:"",onClick:D=>U(o),class:"ml-2"},{default:n(()=>[t(a(m),{icon:"mdi:code-braces",width:"14"})]),_:2},1032,["onClick"])]),_:2},1024)):f("",!0)],2)):(c(),w("div",ce,[t(a(m),{icon:"mdi:thermometer-off",width:"16",height:"16"}),i("span",null,d(a(l)("common.na")),1),o.error?(c(),h(p,{key:0,content:o.error,placement:"top"},{default:n(()=>[t(a(m),{icon:"mdi:alert-circle",class:"ml-2"})]),_:2},1032,["content"])):f("",!0)]))]),_:1},8,["label"]),t(u,{label:a(l)("storageSmart.statusS"),prop:"status",width:"150"},{default:n(({row:o})=>[o.available?(c(),h(B,{key:0,type:W(o.status),effect:"dark"},{default:n(()=>[M(d(a(l)(`storageSmart.statusValues.${o.status}`)),1)]),_:2},1032,["type"])):(c(),w(R,{key:1},[t(B,{type:"info",effect:"dark"},{default:n(()=>[M(d(a(l)("storageSmart.statusValues.unavailable")),1)]),_:1}),o.error?(c(),h(p,{key:0,content:o.error},{default:n(()=>[t(a(m),{icon:"mdi:alert-circle",class:"ml-2"})]),_:2},1032,["content"])):f("",!0)],64))]),_:1},8,["label"]),t(u,{label:"Akcje",width:"120",align:"right"},{default:n(({row:o})=>[t(p,{content:"Pokaż szczegóły",placement:"top"},{default:n(()=>[t(r,{size:"small",circle:"",onClick:D=>G(o.device),class:"action-button"},{default:n(()=>[t(a(m),{icon:"mdi:information-outline",width:"16"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[K,v.value]]),b.value?(c(),w("div",de,[t(a(m),{icon:"mdi:alert-circle",width:"18",height:"18"}),i("span",null,d(b.value),1)])):f("",!0)]),_:1}),t(a(ae),{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=o=>k.value=o),title:"Surowe dane SMART",width:"70%"},{footer:n(()=>[t(r,{onClick:s[0]||(s[0]=o=>k.value=!1)},{default:n(()=>s[2]||(s[2]=[M("Zamknij")])),_:1,__:[2]})]),default:n(()=>[i("pre",null,d(T.value),1)]),_:1},8,["modelValue"])],64)}}}),_e=H(ue,[["__scopeId","data-v-e3e04f3a"]]);export{_e as default};
