import{_ as N,r as z,y as O,k as F,O as q,b as D,e as B,o as f,w as R,c as g,F as A,m as M,h as a,f as U,a as v,l as P,I as w,t as m,G as V,g as $,q as k}from"./index-DxMqavst.js";var x={exports:{}},G=x.exports,T;function K(){return T||(T=1,function(S,b){(function(n,p){S.exports=p()})(G,function(){var n=function(){this._listeners={}};n.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},n.prototype.removeEventListener=function(t,e){if(this._listeners[t]){var s=this._listeners[t].indexOf(e);s>=0&&this._listeners[t].splice(s,1)}},n.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),s=0,h=e.length;s<h;++s)e[s].call(this,t)};var p=function(t){return typeof t.constructor=="function"&&t.constructor.name==="GeneratorFunction"},d=function(t){return{next:function(){var e=t();return e?{value:e}:{done:!0}}}},_=function(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}},E=function(t,e){var s=typeof t;if(s==="object"){if(typeof t.next=="function")return t;if(typeof t.then=="function")return _(t)}return s==="function"?p(t)?t():d(t):_(e.resolve(t))},y=function(t,e,s){this.target=t,this.type=e,this.data=s},r=function(t,e,s){if(n.call(this),typeof e!="number"||Math.floor(e)!==e||e<1)throw new Error("Invalid concurrency");this._concurrency=e,this._options=s||{},this._options.promise=this._options.promise||Promise,this._iterator=E(t,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return r.prototype=new n,r.prototype.constructor=r,r.prototype.concurrency=function(t){return typeof t<"u"&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},r.prototype.size=function(){return this._size},r.prototype.active=function(){return!!this._promise},r.prototype.promise=function(){return this._promise},r.prototype.start=function(){var t=this,e=this._options.promise;return this._promise=new e(function(s,h){t._callbacks={reject:h,resolve:s},t._proceed()}),this._promise},r.prototype._fireEvent=function(t,e){this.dispatchEvent(new y(this,t,e))},r.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},r.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},r.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},r.prototype._trackPromise=function(t){var e=this;t.then(function(s){e._onPooledPromiseFulfilled(t,s)},function(s){e._onPooledPromiseRejected(t,s)}).catch(function(s){e._settle(new Error("Promise processing failed: "+s))})},r.prototype._proceed=function(){if(!this._done){for(var t={done:!1};this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=t===null||!!t.done}this._done&&this._size===0&&this._settle()},r.PromisePoolEvent=y,r.PromisePool=r,r})}(x)),x.exports}K();const L={class:"widget-header"},W={key:0,class:"disk-list"},Y={class:"disk-content"},j={class:"disk-info"},Z={class:"disk-name"},H={class:"disk-path"},J={class:"disk-stats"},Q={class:"temperature"},X={key:1,class:"empty-state"},tt={name:"SmartWidget",displayName:"Status SMART"},et=Object.assign(tt,{setup(S,{expose:b}){const n=z([]),p=z(!1);let d=null;const _=O(()=>n.value.some(o=>!o.status)?"danger":"success"),E=O(()=>{const o=n.value.filter(i=>!i.status).length;return o?`${o} BŁĘDY`:"WSZYSTKO OK"}),y=o=>o.includes("nvme")?"ph:hard-drive":"ph:hard-drives",r=o=>o.split("/").pop().toUpperCase(),t=z(new Set),e=async o=>{const i=new AbortController;t.value.add(i);try{const l=await k.get(`/api/storage/smart/details/${encodeURIComponent(o)}`,{timeout:5e3,signal:i.signal});return{device:o,status:l.data.data.smart_status?.passed||!1,temperature:l.data.data.temperature?.current||null}}catch(l){return k.isCancel(l)||console.error(`Error fetching ${o} details:`,l),{device:o,status:!1,temperature:null}}finally{t.value.delete(i)}},s=()=>{t.value.forEach(o=>{o.abort()}),t.value.clear()},h=async()=>{s();try{p.value=!0;const o=await k.get("/api/storage/smart/monitoring"),i=Object.keys(o.data.devices).filter(u=>o.data.devices[u].monitored),l=2;n.value=[];for(let u=0;u<i.length;u+=l){const C=i.slice(u,u+l),c=await Promise.all(C.map(I=>e(I)));n.value.push(...c)}}catch(o){k.isCancel(o)||console.error("Error:",o),n.value=[]}finally{p.value=!1}};return b({refreshData:async()=>{await h()}}),F(()=>{d&&clearInterval(d),new AbortController,h().finally(()=>{d=setInterval(h,15e3)})}),q(()=>{s(),d&&clearInterval(d)}),(o,i)=>{const l=D("el-tag"),u=D("el-divider"),C=D("el-card");return f(),B(C,{class:"widget-card",shadow:"hover"},{header:R(()=>[a("div",L,[v(P(w),{icon:"ph:hard-drives",width:"18"}),i[0]||(i[0]=a("span",{class:"widget-title"},"Monitorowane dyski",-1)),v(l,{type:_.value,size:"small",effect:_.value==="danger"?"dark":"plain",round:""},{default:R(()=>[$(m(E.value),1)]),_:1},8,["type","effect"])])]),default:R(()=>[n.value.length>0?(f(),g("div",W,[(f(!0),g(A,null,M(n.value,(c,I)=>(f(),g("div",{key:c.device,class:"disk-item"},[a("div",Y,[a("div",j,[v(P(w),{icon:y(c.device),width:"16",class:"disk-icon"},null,8,["icon"]),a("span",Z,m(r(c.device)),1),a("span",H,m(c.device),1)]),a("div",J,[a("div",Q,[v(P(w),{icon:"mdi:thermometer",width:"14"}),a("span",null,m(c.temperature||"--")+"°C",1)]),a("div",{class:V(["status",c.status?"ok":"error"])},m(c.status?"OK":"ERR"),3)])]),I<n.value.length-1?(f(),B(u,{key:0})):U("",!0)]))),128))])):(f(),g("div",X,[v(P(w),{icon:"ph:info",width:"16"}),i[1]||(i[1]=a("span",null,"Brak dysków objętych monitoringiem",-1))]))]),_:1})}}}),rt=N(et,[["__scopeId","data-v-91129a89"]]);export{rt as default};
